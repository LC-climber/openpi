# ğŸ”§ è¯Šæ–­è„šæœ¬ä½¿ç”¨æŒ‡å—

## ğŸ“Š å¯ç”¨çš„è¯Šæ–­å·¥å…·

### 1. è§’åº¦åŒ…è£…è¯Šæ–­è„šæœ¬

**æ–‡ä»¶**ï¼š`angle_wrapping_diagnosis.py`

è¿™ä¸ªè„šæœ¬æ£€æŸ¥æ˜¯å¦å­˜åœ¨è§’åº¦åŒ…è£…é—®é¢˜ã€‚

#### ä½¿ç”¨æ–¹æ³•

```bash
cd /home/er/Code/openpi-v1/openpi/src/openpi/excavator

python angle_wrapping_diagnosis.py
```

#### é¢„æœŸè¾“å‡º

```
================================================================================
ğŸ” è§’åº¦åŒ…è£…é—®é¢˜è¯Šæ–­
================================================================================

ğŸ“Š å…³èŠ‚ 1: å¤§è‡‚ (Boom)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  ğŸ“ˆ æ•°æ®èŒƒå›´:
     çœŸå®å€¼: [-0.1180,  0.7136]
     é¢„æµ‹å€¼: [-0.1827,  0.6599]

  ğŸ“ è¯¯å·®åˆ†æ:
     åŸå§‹ MAE:     0.257336 rad
     åŒ…è£…å MAE:   0.257336 rad
     æ”¹è¿›ç¨‹åº¦:     0.0%

  ğŸ”„ è§’åº¦åŒ…è£…é—®é¢˜:
     éœ€è¦ä¿®æ­£çš„æ ·æœ¬: 0/1300 (0.0%)

ğŸ“Š å…³èŠ‚ 4: å›è½¬ (Swing)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  ğŸ“ˆ æ•°æ®èŒƒå›´:
     çœŸå®å€¼: [ 1.7853,  2.7676]
     é¢„æµ‹å€¼: [-4.3899,  3.1243]

  ğŸ“ è¯¯å·®åˆ†æ:
     åŸå§‹ MAE:     1.185072 rad
     åŒ…è£…å MAE:   0.490930 rad
     æ”¹è¿›ç¨‹åº¦:     58.6%

  ğŸ”„ è§’åº¦åŒ…è£…é—®é¢˜:
     éœ€è¦ä¿®æ­£çš„æ ·æœ¬: 180/1300 (13.8%)

     å‰5ä¸ªä¾‹å­:
       æ ·æœ¬ 3:
         çœŸå®:   2.0738 rad,  é¢„æµ‹:  -2.7163 rad
         åŸå§‹è¯¯å·®:   4.7901 rad
         åŒ…è£…è¯¯å·®:  -1.4931 rad  âœ…
         å·®å¼‚ï¼š3.2970 rad
```

#### å¦‚ä½•ç†è§£è¾“å‡º

| æŒ‡æ ‡ | å«ä¹‰ |
|------|------|
| åŸå§‹ MAE | æœªç»å¤„ç†çš„è¯¯å·®å¹³å‡å€¼ |
| åŒ…è£…å MAE | åº”ç”¨è§’åº¦åŒ…è£…åçš„è¯¯å·®å¹³å‡å€¼ |
| æ”¹è¿›ç¨‹åº¦ | ç™¾åˆ†æ¯”æ”¹è¿› (é«˜ = æœ‰é—®é¢˜) |
| éœ€è¦ä¿®æ­£çš„æ ·æœ¬ | å¤šå°‘æ ·æœ¬å—åˆ°è§’åº¦åŒ…è£…é—®é¢˜å½±å“ |

**è§£è¯»è§„åˆ™**ï¼š
- æ”¹è¿›ç¨‹åº¦ > 30% â†’ å­˜åœ¨ä¸¥é‡çš„è§’åº¦åŒ…è£…é—®é¢˜
- æ”¹è¿›ç¨‹åº¦ < 10% â†’ ä¸å­˜åœ¨è§’åº¦åŒ…è£…é—®é¢˜
- æ”¹è¿›ç¨‹åº¦ = 0% â†’ ç»å¯¹æ²¡æœ‰è§’åº¦åŒ…è£…é—®é¢˜

---

### 2. å¿«é€Ÿè¯Šæ–­è„šæœ¬

**æ–‡ä»¶**ï¼š`quick_diagnosis.py`

è¿™ä¸ªè„šæœ¬è¿›è¡Œå…¨é¢çš„è¯Šæ–­ï¼ŒåŒ…æ‹¬æ€§èƒ½åˆ†æã€æ•°æ®åˆ†å¸ƒæ£€æŸ¥ã€é¢„æµ‹è´¨é‡åˆ†æç­‰ã€‚

#### ä½¿ç”¨æ–¹æ³•

```bash
cd /home/er/Code/openpi-v1/openpi/src/openpi/excavator

python quick_diagnosis.py
```

#### é¢„æœŸè¾“å‡º

```
======================================================================
æŒ–æ˜æœºæ¨ç†ç³»ç»Ÿ - å¿«é€Ÿè¯Šæ–­
======================================================================

âœ… æˆåŠŸç‡: 1300/1300 (100%)
â„¹ï¸  å¹³å‡ MAE: 0.123456 rad
â„¹ï¸  å¹³å‡ RMSE: 0.234567 rad
âš ï¸  æ€§èƒ½è¯„çº§: è‰¯å¥½

ğŸ” æ•°æ®åˆ†å¸ƒæ£€æŸ¥...
âœ… æ•°æ®åˆ†å¸ƒåŒ¹é…ï¼š3.5% è¶…å‡ºèŒƒå›´

ğŸ” é¢„æµ‹è´¨é‡æ£€æŸ¥...
âœ… æ²¡æœ‰å‘ç°ç³»ç»Ÿæ€§åå·®

âš ï¸ è¯Šæ–­ç»“è®º:
  æ¨¡å‹è¡¨ç°ä¸€èˆ¬ï¼Œå­˜åœ¨å¯æ”¹è¿›ç©ºé—´
  æ ¹æœ¬åŸå› ï¼šå¾®è°ƒæ¨¡å‹å¯èƒ½ä¸å¤Ÿå¥½æˆ–é…ç½®ä¸ä¼˜

ğŸ“‹ å»ºè®®è¡ŒåŠ¨:
  1. å¢åŠ è®­ç»ƒæ­¥æ•°
  2. æ£€æŸ¥å­¦ä¹ ç‡
  3. æ·»åŠ è®­ç»ƒæ—¥å¿—ä»¥ä¾¿åç»­è¯Šæ–­
```

#### å¦‚ä½•ç†è§£è¾“å‡º

**æˆåŠŸç‡**ï¼š
- 100% â†’ æ‰€æœ‰æ¨ç†éƒ½æˆåŠŸäº†
- < 100% â†’ æœ‰æ¨ç†å¤±è´¥çš„æ ·æœ¬

**MAE è¯„çº§**ï¼š
- < 0.05 rad â†’ â­â­â­ ä¼˜ç§€
- 0.05-0.10 rad â†’ â­â­ è‰¯å¥½
- 0.10-0.15 rad â†’ â­ å¯æ¥å—
- 0.15-0.20 rad â†’ âš ï¸ éœ€è¦æ”¹è¿›
- \> 0.20 rad â†’ âŒ å¾ˆå·®

**æ•°æ®åˆ†å¸ƒæ£€æŸ¥**ï¼š
- < 5% è¶…å‡ºèŒƒå›´ â†’ âœ… åˆ†å¸ƒåŒ¹é…
- 5-10% è¶…å‡ºèŒƒå›´ â†’ âš ï¸ è½»å¾®ä¸åŒ¹é…
- \> 10% è¶…å‡ºèŒƒå›´ â†’ âŒ ä¸¥é‡ä¸åŒ¹é…

---

## ğŸ” è¯Šæ–­å·¥ä½œæµ

### å®Œæ•´è¯Šæ–­æµç¨‹

```
æ¨ç†å®Œæˆï¼ˆtest_infer_v3.pyï¼‰
    â†“
è¿è¡Œè§’åº¦åŒ…è£…è¯Šæ–­
    python angle_wrapping_diagnosis.py
    â†“
    è¾“å‡º â†’ J4 æ”¹è¿›ç¨‹åº¦
    â†“
    è‹¥ > 30% â†’ å­˜åœ¨è§’åº¦åŒ…è£…é—®é¢˜
    â†“
è¿è¡Œå¿«é€Ÿè¯Šæ–­
    python quick_diagnosis.py
    â†“
    è¾“å‡º â†’ æ•´ä½“è¯Šæ–­ç»“è®º
    â†“
    è‹¥ MAE < 0.2 â†’ é—®é¢˜å·²è§£å†³
    è‹¥ MAE > 0.2 â†’ éœ€è¦è¿›ä¸€æ­¥è°ƒæŸ¥
```

---

## ğŸ“Š è¯Šæ–­å†³ç­–æ ‘

### å¦‚ä½•æ ¹æ®è¯Šæ–­ç»“æœå†³å®šä¸‹ä¸€æ­¥ï¼Ÿ

```
è¿è¡Œè¯Šæ–­
    â†“
â”œâ”€ J4 æ”¹è¿› < 10% ?
â”‚  â””â”€ YES â†’ æ²¡æœ‰è§’åº¦åŒ…è£…é—®é¢˜ï¼Œé—®é¢˜å¯èƒ½æ˜¯åˆ«çš„
â”‚
â”œâ”€ J4 æ”¹è¿› > 30% ?
â”‚  â””â”€ YES â†’ å­˜åœ¨ä¸¥é‡çš„è§’åº¦åŒ…è£…é—®é¢˜
â”‚         â†’ åº”ç”¨å¿«é€Ÿä¿®å¤ï¼ˆtest_infer_v3.py ä¸­æ·»åŠ  apply_angle_wrappingï¼‰
â”‚
â”œâ”€ J3 MAE > 0.8 rad ?
â”‚  â””â”€ YES â†’ æ•°æ®å¤„ç†ç®¡é“é—®é¢˜ï¼ˆé—®é¢˜Aï¼‰
â”‚         â†’ éœ€è¦é‡æ–°è®­ç»ƒ
â”‚
â””â”€ æ‰€æœ‰ MAE < 0.3 rad ?
   â””â”€ YES â†’ æ‰€æœ‰é—®é¢˜éƒ½è§£å†³äº†ï¼ğŸ‰
```

---

## ğŸ’» é«˜çº§è¯Šæ–­ï¼šæ‰‹åŠ¨åˆ†æ

å¦‚æœéœ€è¦æ›´æ·±å…¥çš„åˆ†æï¼Œå¯ä»¥æ‰‹åŠ¨æ£€æŸ¥è¾“å‡ºæ–‡ä»¶ï¼š

### æ£€æŸ¥é¢„æµ‹æ•°æ®

```bash
cd /home/er/Code/openpi-v1/output_v3

# æŸ¥çœ‹å‰10è¡Œé¢„æµ‹æ•°æ®
head -10 v3_predictions.csv

# ç»Ÿè®¡æ¯ä¸ªå…³èŠ‚çš„è¯¯å·®
python3 << 'EOF'
import pandas as pd
import numpy as np

df = pd.read_csv('v3_predictions.csv')

for i in range(1, 5):
    true_col = f'true_J{i}'
    pred_col = f'pred_J{i}'

    error = df[true_col] - df[pred_col]
    mae = np.abs(error).mean()
    bias = error.mean()
    std = error.std()

    print(f"J{i}: MAE={mae:.4f}, Bias={bias:.4f}, Std={std:.4f}")

    # æ£€æŸ¥æ˜¯å¦æœ‰å¤§çš„é”™è¯¯
    large_errors = np.sum(np.abs(error) > 1.0)
    print(f"    > 1.0 rad çš„é”™è¯¯: {large_errors}")
EOF
```

### æ£€æŸ¥è§’åº¦åˆ†å¸ƒ

```bash
python3 << 'EOF'
import pandas as pd
import numpy as np

df = pd.read_csv('v3_predictions.csv')

# æ£€æŸ¥ J4 çš„è§’åº¦åˆ†å¸ƒ
j4_true = df['true_J4'].values
j4_pred = df['pred_J4'].values

print(f"J4 çœŸå®å€¼èŒƒå›´: [{j4_true.min():.2f}, {j4_true.max():.2f}]")
print(f"J4 é¢„æµ‹å€¼èŒƒå›´: [{j4_pred.min():.2f}, {j4_pred.max():.2f}]")

# è®¡ç®—æœ‰å¤šå°‘é¢„æµ‹å€¼è·¨è¶Š Â±Ï€ è¾¹ç•Œ
crosses = np.sum((j4_true > 0) != (j4_pred > 0))
print(f"J4 ç¬¦å·åè½¬æ¬¡æ•°: {crosses}")

# è®¡ç®—è·¨è¶Š 2Ï€ å€æ•°çš„æ¬¡æ•°
diffs = np.abs(j4_true - j4_pred)
large_diffs = np.sum(diffs > np.pi)
print(f"J4 è¯¯å·® > Ï€ çš„æ¬¡æ•°: {large_diffs}")
EOF
```

---

## ğŸ¯ å¸¸ç”¨è¯Šæ–­å‘½ä»¤

### å¿«é€Ÿæ£€æŸ¥ MAE

```bash
# æŸ¥çœ‹ JSON æ ¼å¼çš„ç»Ÿè®¡
python3 -c "
import json
data = json.load(open('/home/er/Code/openpi-v1/output_v3/v3_stats.json'))
print('å…³èŠ‚\tMAE\t\tRMSE')
for i, (mae, rmse) in enumerate(zip(data['MAE'], data['RMSE']), 1):
    print(f'J{i}\t{mae:.4f}\t\t{rmse:.4f}')
"
```

### æ£€æŸ¥æ‰€æœ‰å…³èŠ‚çš„æ”¹è¿›

```bash
# è¿è¡Œå®Œæ•´è¯Šæ–­å¹¶åªæ˜¾ç¤ºå…³é”®ä¿¡æ¯
python3 << 'EOF'
import json

# ä¿®å¤å‰çš„æ•°æ®ï¼ˆä» v3_stats.jsonï¼‰
with open('/home/er/Code/openpi-v1/output_v3/v3_stats.json') as f:
    stats = json.load(f)

mae_values = stats['MAE']
print("è¯Šæ–­ç»“æœ:")
print("å…³èŠ‚\tåŸå§‹MAE\tä¿®å¤å(é¢„æœŸ)\tæ”¹è¿›")
print("â”€" * 50)
for i, mae in enumerate(mae_values, 1):
    if i == 4:  # J4 ç‰¹æ®Šå¤„ç†ï¼ˆè§’åº¦åŒ…è£…ï¼‰
        expected = 0.49
        improvement = (1 - expected / mae) * 100
        status = "âœ… åº”ç”¨è§’åº¦åŒ…è£…"
    elif i == 3:  # J3 éœ€è¦é‡æ–°è®­ç»ƒ
        expected = 0.40
        improvement = (1 - expected / mae) * 100
        status = "â³ éœ€è¦é‡æ–°è®­ç»ƒ"
    else:  # J1, J2 å·²ç»æ­£å¸¸
        expected = mae
        improvement = 0
        status = "âœ… å·²æ­£å¸¸"

    print(f"J{i}\t{mae:.3f}\t\t{expected:.3f}\t\t{improvement:.0f}% {status}")
EOF
```

---

## ğŸš€ å®é™…ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1ï¼šæˆ‘æƒ³å¿«é€Ÿæ£€æŸ¥è§’åº¦åŒ…è£…é—®é¢˜

```bash
cd /home/er/Code/openpi-v1/openpi/src/openpi/excavator
python angle_wrapping_diagnosis.py
# æŸ¥çœ‹ J4 çš„æ”¹è¿›ç¨‹åº¦æ˜¯å¦ > 30%
```

### åœºæ™¯2ï¼šæˆ‘æƒ³è¿›è¡Œå…¨é¢è¯Šæ–­

```bash
cd /home/er/Code/openpi-v1/openpi/src/openpi/excavator
python quick_diagnosis.py
# æŸ¥çœ‹æ¯ä¸ªå…³èŠ‚çš„ MAE å’Œæ•´ä½“è¯Šæ–­ç»“è®º
```

### åœºæ™¯3ï¼šæˆ‘æƒ³è‡ªå·±åˆ†æè¯Šæ–­æ•°æ®

```bash
cd /home/er/Code/openpi-v1/output_v3

# æ–¹æ³•1ï¼šç®€å•æŸ¥çœ‹ JSON
python3 -m json.tool v3_stats.json

# æ–¹æ³•2ï¼šæŸ¥çœ‹ CSV æ•°æ®
head -20 v3_predictions.csv
tail -20 v3_predictions.csv

# æ–¹æ³•3ï¼šPython æ·±å…¥åˆ†æ
python verify_training_data.py  # æ£€æŸ¥è®­ç»ƒæ•°æ®
```

---

## ğŸ“ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šè¯Šæ–­è„šæœ¬æ‰¾ä¸åˆ°è¾“å‡ºæ–‡ä»¶

```bash
# ç¡®ä¿æ¨ç†è„šæœ¬å·²æˆåŠŸè¿è¡Œ
ls -lh /home/er/Code/openpi-v1/output_v3/

# åº”è¯¥çœ‹åˆ°ï¼š
# v3_stats.json
# v3_predictions.csv
# v3_1_time_series.png
# ...
```

### é—®é¢˜ï¼šè¯Šæ–­è„šæœ¬æŠ¥é”™

```bash
# ç¡®ä¿å·²å®‰è£…å¿…è¦çš„åº“
pip install pandas numpy

# é‡æ–°è¿è¡Œ
python angle_wrapping_diagnosis.py
```

### é—®é¢˜ï¼šè¯Šæ–­ç»“æœå’Œé¢„æœŸä¸ç¬¦

1. æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„ checkpoint
2. æŸ¥çœ‹æ—¥å¿—ä¸­æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. ç¡®ä¿åº”ç”¨äº†æ‰€æœ‰å¿…è¦çš„ä¿®å¤

---

## ğŸ“š è¯Šæ–­å·¥å…·çš„æ–‡ä»¶ä½ç½®

```
/home/er/Code/openpi-v1/openpi/src/openpi/excavator/
â”œâ”€â”€ angle_wrapping_diagnosis.py      â† è§’åº¦åŒ…è£…è¯Šæ–­
â”œâ”€â”€ quick_diagnosis.py                â† å¿«é€Ÿè¯Šæ–­
â”œâ”€â”€ verify_training_data.py           â† æ•°æ®éªŒè¯
â””â”€â”€ test_infer_v3.py                  â† æ¨ç†è„šæœ¬ï¼ˆéœ€è¦ä¿®æ”¹ï¼‰
```

---

**ç°åœ¨ä½ æœ‰äº†å®Œæ•´çš„è¯Šæ–­å·¥å…·ç®±ï¼** ğŸ”§ğŸ‰
